<!doctype html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <title>进出明细</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="/static/component/pear/css/pear.css" />
    <link rel="stylesheet" href="/static/admin/css/admin.css" />
    <script src="/static/component/layui/layui.js"></script>
    <script src="/static/component/pear/pear.js"></script>
</head>

<body>
    <div style="padding: 16px">
        <div class="layui-card">
            <div class="layui-card-body">
                <form class="layui-form search-form" action="">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">类型</label>
                            <div class="layui-input-inline">
                                <select name="type">
                                    <option value="">全部</option>
                                    <option value="in">入库</option>
                                    <option value="out">出库</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button class="layui-btn layui-btn-primary layui-border-blue" lay-submit
                                lay-filter="data-search-btn">筛选</button>
                            <button class="layui-btn layui-btn-primary" type="reset">重置</button>
                        </div>
                    </div>
                </form>

                <table id="historyTableId" lay-filter="historyTableFilter"></table>
            </div>
        </div>
    </div>

    <script>
        layui.use(['table', 'form'], function () {
            var $ = layui.jquery,
                table = layui.table,
                form = layui.form;

            table.render({
                elem: '#historyTableId',
                url: '/api/v1/nursery/transactions',
                cols: [[
                    { field: 'order_no', width: 180, title: '单号', sort: true },
                    {
                        field: 'type', width: 80, title: '类型', templet: function (d) {
                            if (d.type === 'in') {
                                return '<span class="layui-badge layui-bg-green">入库</span>';
                            } else {
                                return '<span class="layui-badge layui-bg-orange">出库</span>';
                            }
                        }
                    },
                    { field: 'plant_name', width: 150, title: '苗木名称' },
                    { field: 'spec', width: 150, title: '规格' },
                    { field: 'quantity', width: 100, title: '数量', sort: true },
                    {
                        field: 'price', width: 120, title: '单价', sort: true, templet: function (d) {
                            return parseFloat(d.price).toFixed(2);
                        }
                    },
                    {
                        field: 'total_price', width: 120, title: '总价', sort: true, templet: function (d) {
                            return parseFloat(d.total_price).toFixed(2);
                        }
                    },
                    { field: 'destination', width: 150, title: '去向/来源' },
                    { field: 'operator', width: 100, title: '操作人' },
                    { field: 'create_at', width: 170, title: '时间', sort: true },
                    { field: 'remark', title: '备注' }
                ]],
                limits: [10, 15, 20, 25, 50, 100],
                limit: 15,
                page: true,
                skin: 'line'
            });

            form.on('submit(data-search-btn)', function (data) {
                table.reload('historyTableId', {
                    page: { curr: 1 },
                    where: data.field
                }, 'data');
                return false;
            });
        });
    </script>
</body>

</html>