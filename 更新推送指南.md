# ä»£ç æ›´æ–°ä¸éƒ¨ç½²æŒ‡å—

> é€‚ç”¨äºæ—¥å¸¸ä»£ç æ›´æ–°å’Œæ¨é€åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨

---

## ğŸ“‹ æœ¬åœ°æ›´æ–°æµç¨‹

### 1. æ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\pear_admin\pear-admin-flask

# æŸ¥çœ‹ä¿®æ”¹äº†å“ªäº›æ–‡ä»¶
git status

# æ·»åŠ æ‰€æœ‰ä¿®æ”¹
git add .

# æˆ–è€…åªæ·»åŠ ç‰¹å®šæ–‡ä»¶
git add pear_admin/orms/supplier.py
git add templates/order_pay/pay_base.html
```

### 2. æäº¤ä¿®æ”¹

```powershell
# æäº¤å¹¶æ·»åŠ è¯´æ˜
git commit -m "æè¿°ä½ åšäº†ä»€ä¹ˆä¿®æ”¹"

# ç¤ºä¾‹ï¼š
# git commit -m "feat: æ·»åŠ ä¾›åº”å•†æ‰“å°åŠŸèƒ½"
# git commit -m "fix: ä¿®å¤ä»˜æ¬¾å•æ˜¾ç¤ºé—®é¢˜"
# git commit -m "refactor: ä¼˜åŒ–ä»£ç ç»“æ„"
```

### 3. æ¨é€åˆ°è¿œç¨‹ä»“åº“

```powershell
git push
```

---

## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æµç¨‹

### åœºæ™¯ä¸€ï¼šåªæ›´æ–°ä»£ç ï¼ˆä¸æ”¹æ•°æ®åº“ï¼‰

**é€‚ç”¨**ï¼šä¿®æ”¹äº†ä¸šåŠ¡é€»è¾‘ã€å‰ç«¯é¡µé¢ã€APIç­‰ï¼Œä½†æ²¡æœ‰æ”¹è¡¨ç»“æ„

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@8.159.138.234

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/pear-admin-flask

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡å¯webå®¹å™¨
docker-compose restart web

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
docker-compose logs --tail=20 web
```

> âœ… **æ•°æ®ä¿æŠ¤**ï¼šé‡å¯å®¹å™¨ä¸ä¼šè¦†ç›–å·²å¯¼å…¥çš„ä¾›åº”å•†æ•°æ®ï¼ˆ1087æ¡ï¼‰

---

### åœºæ™¯äºŒï¼šæ›´æ–°äº†ORMæ¨¡å‹æˆ–Pythonæ ¸å¿ƒä»£ç 

**é€‚ç”¨**ï¼šä¿®æ”¹äº†ORMæ¨¡å‹ã€æ‰©å±•æ¨¡å—ç­‰éœ€è¦é‡æ–°æ„å»ºé•œåƒçš„æƒ…å†µ

```bash
ssh root@8.159.138.234
cd /root/pear-admin-flask

# æ‹‰å–ä»£ç 
git pull

# å®Œå…¨é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose down
docker rmi pear-admin-flask-web
docker-compose build --no-cache web
docker-compose up -d

# ç­‰å¾…å¯åŠ¨
sleep 20

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs --tail=30 web
```

**é¢„æœŸæ—¥å¿—**ï¼š
```
âœ“ Database already initialized with 1087 suppliers. Skipping initialization to preserve data.
Starting application...
```

> âœ… **æ•°æ®ä¿æŠ¤**ï¼šå®¹å™¨ä¼šæ£€æµ‹åˆ°å·²æœ‰æ•°æ®ï¼Œè‡ªåŠ¨è·³è¿‡åˆå§‹åŒ–

---

### åœºæ™¯ä¸‰ï¼šå¤„ç†Gitå†²çª

å¦‚æœåœ¨æœåŠ¡å™¨ä¸Š `git pull` æ—¶é‡åˆ°å†²çªï¼š

```bash
# é”™è¯¯ç¤ºä¾‹ï¼š
# error: The following untracked working tree files would be overwritten by merge

# è§£å†³æ–¹æ¡ˆ1ï¼šåˆ é™¤å†²çªæ–‡ä»¶
rm scripts/import_all_data.py
rm scripts/import_suppliers_mysql.py
git pull

# è§£å†³æ–¹æ¡ˆ2ï¼šå¤‡ä»½ååˆ é™¤
mv scripts/import_all_data.py /tmp/backup/
git pull

# è§£å†³æ–¹æ¡ˆ3ï¼šå¼ºåˆ¶é‡ç½®ï¼ˆæ…ç”¨ï¼‰
git reset --hard HEAD
git pull
```

---

## ğŸ“Š æ•°æ®ç®¡ç†

### ä¾›åº”å•†æ•°æ®åŒæ­¥

**é¦–æ¬¡éƒ¨ç½²æˆ–æ•°æ®ä¸¢å¤±æ—¶**ï¼Œç”¨Navicatä¼ è¾“æ•°æ®ï¼š

1. æ‰“å¼€Navicat â†’ å·¥å…· â†’ æ•°æ®ä¼ è¾“
2. æºï¼š`Local_Pear_Admin` (SQLite) â†’ `ums_supplier`
3. ç›®æ ‡ï¼šMySQL (8.159.138.234) â†’ `pear_admin.ums_supplier`
4. å‹¾é€‰"åˆ›å»ºå‰åˆ é™¤ç›®æ ‡å¯¹è±¡"
5. å¼€å§‹ä¼ è¾“

**éªŒè¯æ•°æ®**ï¼š
```bash
docker exec -it pear_admin_mysql mysql -u root -p pear_admin
SELECT COUNT(*) FROM ums_supplier;  # åº”æ˜¾ç¤º1087
```

### æ•°æ®ä¿æŠ¤æœºåˆ¶è¯´æ˜

- **è‡ªåŠ¨æ£€æµ‹**ï¼šå®¹å™¨å¯åŠ¨æ—¶æ£€æŸ¥ `ums_supplier` è¡¨è®°å½•æ•°
- **ä¿æŠ¤æ¡ä»¶**ï¼šå¦‚æœæœ‰è¶…è¿‡10æ¡è®°å½•ï¼Œè·³è¿‡åˆå§‹åŒ–
- **å¥½å¤„**ï¼š
  - âœ… ä»£ç æ›´æ–°ä¸ä¼šä¸¢å¤±æ•°æ®
  - âœ… å®¹å™¨é‡å¯ä¸ä¼šæ¸…ç©ºä¾›åº”å•†
  - âœ… åªæœ‰é¦–æ¬¡éƒ¨ç½²éœ€è¦å¯¼å…¥

**å®Œå…¨é‡ç½®æ•°æ®åº“**ï¼ˆæ…ç”¨ï¼‰ï¼š
```bash
docker-compose down -v  # -v åˆ é™¤æ•°æ®å·
docker-compose up -d
# ç„¶åç”¨Navicaté‡æ–°å¯¼å…¥
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```

**é¢„æœŸè¾“å‡º**ï¼š
```
pear_admin_mysql   Up
pear_admin_nginx   Up
pear_admin_web     Up
```

### 2. æ£€æŸ¥åº”ç”¨æ—¥å¿—
```bash
docker-compose logs --tail=50 web | grep -i error
```

**é¢„æœŸ**ï¼šæ— é”™è¯¯æˆ–åªæœ‰åˆå§‹åŒ–è„šæœ¬çš„è­¦å‘Š

### 3. è®¿é—®Webé¡µé¢
- URL: `http://8.159.138.234:5050/`
- ç™»å½•: wym / 123456
- æ£€æŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹webæ—¥å¿—
docker-compose logs -f web

# æŸ¥çœ‹MySQLæ—¥å¿—
docker-compose logs --tail=100 mysql

# æŸ¥çœ‹nginxæ—¥å¿—
docker-compose logs --tail=50 nginx
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥webå®¹å™¨
docker exec -it pear_admin_web bash

# è¿›å…¥MySQLå®¹å™¨
docker exec -it pear_admin_mysql mysql -u root -p pear_admin
```

### æ¸…ç†èµ„æº
```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨é€å‰æ£€æŸ¥**ï¼š
   - âœ… æœ¬åœ°æµ‹è¯•é€šè¿‡
   - âœ… æ²¡æœ‰è°ƒè¯•ä»£ç 
   - âœ… commitä¿¡æ¯æ¸…æ™°

2. **éƒ¨ç½²æ—¶æ£€æŸ¥**ï¼š
   - âœ… å…ˆå¤‡ä»½æ•°æ®åº“ï¼ˆé‡è¦æ›´æ–°æ—¶ï¼‰
   - âœ… é€‰æ‹©åˆé€‚çš„éƒ¨ç½²åœºæ™¯
   - âœ… æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ— é”™è¯¯

3. **æ•°æ®å®‰å…¨**ï¼š
   - âœ… é‡è¦æ›´æ–°å‰æ‰‹åŠ¨å¤‡ä»½MySQL
   - âœ… ä¸è¦è½»æ˜“ä½¿ç”¨ `docker-compose down -v`
   - âœ… å®šæœŸå¯¼å‡ºä¾›åº”å•†æ•°æ®

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šé¡µé¢500é”™è¯¯
```bash
docker-compose logs --tail=100 web | grep -i error
```

### é—®é¢˜2ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥
```bash
docker-compose ps
docker-compose logs web
```

### é—®é¢˜3ï¼šæ•°æ®æ²¡äº†
```bash
# æ£€æŸ¥è®°å½•æ•°
docker exec -it pear_admin_mysql mysql -u root -p pear_admin -e "SELECT COUNT(*) FROM ums_supplier;"

# å¦‚æœæ˜¯0æˆ–7ï¼Œç”¨Navicaté‡æ–°å¯¼å…¥
```

---

**æœ€åæ›´æ–°**ï¼š2026-01-15  
**ç‰ˆæœ¬**ï¼šv2.0 (å«æ•°æ®ä¿æŠ¤æœºåˆ¶)
