# é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

## ğŸ“‹ éƒ¨ç½²ä¿¡æ¯

- **GitHub ä»“åº“**: https://github.com/wuyongming1984/pear-admin-flask.git
- **æœåŠ¡å™¨å®ä¾‹**: i-uf6grczcwjr1t7f5efkv
- **ç”¨æˆ·å**: root
- **éƒ¨ç½²ç«¯å£**: 5050

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5æ­¥å®Œæˆï¼‰

### ç¬¬ä¸€æ­¥ï¼šè·å–æœåŠ¡å™¨å…¬ç½‘ IP

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°ï¼šhttps://ecs.console.aliyun.com
2. æ‰¾åˆ°å®ä¾‹ `i-uf6grczcwjr1t7f5efkv`
3. è®°ä¸‹å…¬ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ï¼š8.159.138.234ï¼‰

### ç¬¬äºŒæ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

åœ¨æœ¬åœ° PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
# æ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨å…¬ç½‘ IP
ssh root@8.159.138.234

# è¾“å…¥å¯†ç åç™»å½•
```Wu19840506

### ç¬¬ä¸‰æ­¥ï¼šå…‹éš† GitHub ä»£ç 

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# è¿›å…¥ root ç›®å½•
cd /root
rm -rf pear-admin-flask
# å…‹éš† GitHub ä»“åº“
git clone https://github.com/wuyongming1984/pear-admin-flask.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd pear-admin-flask

# æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦éƒ½åœ¨
ls -la
```

### ç¬¬å››æ­¥ï¼šä¸€é”®éƒ¨ç½²

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå›½å†…ä¼˜åŒ–ç‰ˆï¼‰
./deploy.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š
- âœ… å®‰è£… Docker å’Œ Docker Compose
- âœ… **é…ç½® Docker é•œåƒåŠ é€Ÿå™¨**ï¼ˆä½¿ç”¨å›½å†…æºï¼Œè§£å†³æ‹‰å–é•œåƒæ…¢çš„é—®é¢˜ï¼‰
- âœ… ç”Ÿæˆéšæœºå®‰å…¨å¯†ç 
- âœ… æ„å»ºåº”ç”¨é•œåƒï¼ˆä½¿ç”¨åŠ é€Ÿå™¨åé€Ÿåº¦æå‡ 10 å€ï¼‰
- âœ… å¯åŠ¨ MySQL å’Œ Flask æœåŠ¡

**é•œåƒåŠ é€Ÿå™¨è¯´æ˜**ï¼š
- ä½¿ç”¨ä¸­ç§‘å¤§é•œåƒæº
- ä½¿ç”¨ç½‘æ˜“é•œåƒæº
- ä½¿ç”¨ç™¾åº¦é•œåƒæº
- è‡ªåŠ¨é…ç½®æ—¥å¿—è½®è½¬ï¼ˆé˜²æ­¢æ—¥å¿—å æ»¡ç£ç›˜ï¼‰

**é‡è¦**ï¼šè„šæœ¬æ‰§è¡Œå®Œæˆåä¼šæ˜¾ç¤ºæ•°æ®åº“å¯†ç ï¼Œè¯·ä¿å­˜è¿™äº›å¯†ç ï¼

**é¢„è®¡æ—¶é—´**ï¼šé¦–æ¬¡éƒ¨ç½²çº¦ 5-10 åˆ†é’Ÿï¼ˆä¹‹å‰éœ€è¦ 30 åˆ†é’Ÿæˆ–è¶…æ—¶ï¼‰

### ç¬¬äº”æ­¥ï¼šé…ç½®å®‰å…¨ç»„

1. è¿”å›é˜¿é‡Œäº‘æ§åˆ¶å°
2. æ‰¾åˆ°å®ä¾‹ `i-uf6grczcwjr1t7f5efkv`
3. ç‚¹å‡»"å®‰å…¨ç»„" â†’ "é…ç½®è§„åˆ™" â†’ "æ‰‹åŠ¨æ·»åŠ "
4. æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

| åè®®ç±»å‹ | ç«¯å£èŒƒå›´ | æˆæƒå¯¹è±¡ | è¯´æ˜ |
|---------|---------|---------|------|
| TCP | 5050 | 0.0.0.0/0 | Flask åº”ç”¨ç«¯å£ |
| TCP | 22 | 0.0.0.0/0 | SSH è¿æ¥ |

5. ç‚¹å‡»"ä¿å­˜"

### ç¬¬å…­æ­¥ï¼šè®¿é—®åº”ç”¨

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š

```
http://<ä½ çš„æœåŠ¡å™¨IP>:5050
```

ğŸ‰ éƒ¨ç½²å®Œæˆï¼

## ğŸ“ å®Œæ•´éƒ¨ç½²å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´ç‰ˆï¼‰

### åœ¨æœ¬åœ° PowerShell æ‰§è¡Œï¼š

```powershell
# è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@8.159.138.234
# è¾“å…¥å¯†ç åç™»å½•
```

### åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆä¸€é”®å‘½ä»¤ï¼‰ï¼š

```bash
cd /root && git clone https://github.com/wuyongming1984/pear-admin-flask.git && cd pear-admin-flask && chmod +x deploy.sh && ./deploy.sh
```

### æˆ–è€…åˆ†æ­¥æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥ root ç›®å½•
cd /root

# 2. å…‹éš†ä»£ç 
git clone https://github.com/wuyongming1984/pear-admin-flask.git

# 3. è¿›å…¥é¡¹ç›®ç›®å½•
cd pear-admin-flask

# 4. æ‰§è¡Œéƒ¨ç½²è„šæœ¬
chmod +x deploy.sh
./deploy.sh
```

## ğŸ” éªŒè¯éƒ¨ç½²çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€
docker-compose ps

# åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªæœåŠ¡éƒ½åœ¨è¿è¡Œï¼š
# - pear_admin_mysql (Up)
# - pear_admin_web   (Up)

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ Web åº”ç”¨æ—¥å¿—
docker-compose logs -f web

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs -f mysql
```

## âš™ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# åœæ­¢æœåŠ¡
docker-compose stop

# å¯åŠ¨æœåŠ¡
docker-compose start

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# è¿›å…¥ Web å®¹å™¨
docker-compose exec web bash

# è¿›å…¥ MySQL å®¹å™¨
docker-compose exec mysql bash
```

## ğŸ”„ æ›´æ–°ä»£ç ï¼ˆä»¥åä¿®æ”¹ä»£ç åï¼‰

### æ–¹æ³• 1ï¼šå¿«é€Ÿæ›´æ–°ï¼ˆåªæ›´æ–°ä»£ç ï¼Œä¸é‡æ–°æ„å»ºé•œåƒï¼‰

```bash
cd /root/pear-admin-flask
git pull
docker-compose restart web
```

### æ–¹æ³• 2ï¼šå®Œæ•´æ›´æ–°ï¼ˆé‡æ–°æ„å»ºé•œåƒï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /root/pear-admin-flask

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose down
docker-compose build --no-cache web
docker-compose up -d

# æ›´æ–°æ•°æ®åº“
docker-compose exec web python scripts/update_db_schema.py



# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
docker-compose logs -f web
```

### æ–¹æ³• 3ï¼šå¼ºåˆ¶é‡æ–°éƒ¨ç½²ï¼ˆæ¨èï¼Œæœ€å½»åº•ï¼‰

```bash
cd /root
rm -rf pear-admin-flask
git clone https://github.com/wuyongming1984/pear-admin-flask.git
cd pear-admin-flask
chmod +x deploy.sh
./deploy.sh
```


# å®Œå…¨é‡å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose down
docker rmi pear-admin-flask-web
docker-compose build --no-cache web
docker-compose up -d

## â— å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ— æ³•è¿æ¥æœåŠ¡å™¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ssh: connect to host port 22: Connection refused
```

**åŸå› **ï¼š
1. SSH å‘½ä»¤æ ¼å¼é”™è¯¯ï¼ˆå¦‚ï¼š`ssh root@ 8.159.138.234` æœ‰ç©ºæ ¼ï¼‰
2. å®‰å…¨ç»„æœªå¼€æ”¾ 22 ç«¯å£

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1**ï¼šä¿®æ­£ SSH å‘½ä»¤
```bash
# é”™è¯¯ç¤ºä¾‹
ssh root@ 8.159.138.234  # âŒ @ å’Œ IP ä¹‹é—´æœ‰ç©ºæ ¼

# æ­£ç¡®ç¤ºä¾‹
ssh root@8.159.138.234   # âœ… æ²¡æœ‰ç©ºæ ¼
```

**æ–¹æ¡ˆ 2**ï¼šé…ç½®å®‰å…¨ç»„
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. æ‰¾åˆ°å®ä¾‹ â†’ å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™
3. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼šç«¯å£ 22ï¼Œåè®® TCPï¼Œæˆæƒå¯¹è±¡ 0.0.0.0/0

**æ–¹æ¡ˆ 3**ï¼šä½¿ç”¨é˜¿é‡Œäº‘æ§åˆ¶å°è¿œç¨‹è¿æ¥ï¼ˆæ¨èï¼‰
1. é˜¿é‡Œäº‘æ§åˆ¶å° â†’ å®ä¾‹
2. ç‚¹å‡»"è¿œç¨‹è¿æ¥"æŒ‰é’®
3. é€‰æ‹© Workbench æˆ– VNC è¿œç¨‹è¿æ¥

### é—®é¢˜ 2ï¼šDocker é•œåƒæ‹‰å–è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
failed to solve: DeadlineExceeded: python:3.10-slim: 
dial tcp 69.171.224.36:443: i/o timeout
```

**åŸå› **ï¼šå›½å†…è®¿é—® Docker Hub å¾ˆæ…¢æˆ–è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š

âœ… **æ–°ç‰ˆéƒ¨ç½²è„šæœ¬å·²è‡ªåŠ¨è§£å†³æ­¤é—®é¢˜ï¼**

æ–°çš„ `deploy.sh` è„šæœ¬å·²è‡ªåŠ¨é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜ï¼Œæ‰‹åŠ¨é…ç½®ï¼š

```bash
# é…ç½®é•œåƒåŠ é€Ÿå™¨
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# é‡å¯ Docker
sudo systemctl daemon-reload
sudo systemctl restart docker

# é‡æ–°éƒ¨ç½²
cd /root/pear-admin-flask
docker-compose down -v
docker-compose build --no-cache
docker-compose up -d
```

### é—®é¢˜ 3ï¼šgit clone å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
fatal: unable to access 'https://github.com/...': Could not resolve host
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ 1ï¼šæ£€æŸ¥ç½‘ç»œ
ping github.com

# æ–¹æ¡ˆ 2ï¼šå¤šè¯•å‡ æ¬¡
git clone https://github.com/wuyongming1984/pear-admin-flask.git

# æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Gitee é•œåƒ
# å…ˆåœ¨ Gitee åˆ›å»ºä»“åº“å¹¶åŒæ­¥ GitHub ä»£ç 
git clone https://gitee.com/ä½ çš„ç”¨æˆ·å/pear-admin-flask.git
```

### é—®é¢˜ 4ï¼šç³»ç»ŸæœåŠ¡é‡å¯æç¤º

**ç°è±¡**ï¼šå‡ºç° "Daemons using outdated libraries" å¯¹è¯æ¡†

**è§£å†³**ï¼š
- æŒ‰ Tab é”®åˆ‡æ¢åˆ° `<Ok>`
- æŒ‰ Enter ç¡®è®¤
- è¿™æ˜¯æ­£å¸¸çš„ç³»ç»Ÿæ›´æ–°æç¤ºï¼Œä¸å½±å“éƒ¨ç½²

### é—®é¢˜ 5ï¼šæ— æ³•è®¿é—® http://IP:5050

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 5050 ç«¯å£
2. âœ… æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker-compose ps`
3. âœ… æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs web`
4. âœ… æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`

### é—®é¢˜ 6ï¼šMySQL è¿æ¥å¤±è´¥

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹ MySQL å®¹å™¨çŠ¶æ€
docker-compose ps mysql

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs mysql

# é‡å¯ MySQL
docker-compose restart mysql

# ç­‰å¾… 30 ç§’åé‡å¯ Web
docker-compose restart web
```

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹ SSH å¯†ç 

```bash
passwd
# è¾“å…¥æ–°å¯†ç 
```

### 2. ä¿®æ”¹ .env ä¸­çš„å¯†ç 

```bash
cd /root/pear-admin-flask
nano .env
# ä¿®æ”¹æ‰€æœ‰å¯†ç ä¸ºå¼ºå¯†ç 
```

### 3. é™åˆ¶ SSH è®¿é—® IP

åœ¨é˜¿é‡Œäº‘å®‰å…¨ç»„ä¸­ï¼š
- å°† 22 ç«¯å£çš„æˆæƒå¯¹è±¡ä» `0.0.0.0/0` æ”¹ä¸ºä½ çš„å›ºå®š IP

### 4. é…ç½®é˜²ç«å¢™

```bash
# å¯ç”¨é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 5050
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹ç³»ç»Ÿèµ„æº

```bash
# æŸ¥çœ‹ CPU å’Œå†…å­˜
htop
# æˆ–
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ Docker å®¹å™¨èµ„æº
docker stats

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp
```

### è®¾ç½®æ—¥å¿—è½®è½¬

```bash
# é™åˆ¶ Docker æ—¥å¿—å¤§å°
sudo nano /etc/docker/daemon.json
```

æ·»åŠ ï¼š
```json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

é‡å¯ Dockerï¼š
```bash
sudo systemctl restart docker
```

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### 1. é…ç½® Nginx åå‘ä»£ç†

å¯ä»¥é€šè¿‡ 80 ç«¯å£è®¿é—®ï¼Œæ— éœ€åŠ ç«¯å£å·ï¼š

```bash
# å®‰è£… Nginx
sudo apt-get install -y nginx

# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/pear-admin

# æ·»åŠ é…ç½®ï¼ˆå‚è€ƒ DEPLOY.mdï¼‰

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/pear-admin /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 2. é…ç½® HTTPS

ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼š

```bash
sudo apt-get install -y certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com
```

### 3. é…ç½®è‡ªåŠ¨å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano /root/backup.sh
```

æ·»åŠ ï¼š
```bash
#!/bin/bash
cd /root/pear-admin-flask
docker-compose exec mysql mysqldump -u root -på¯†ç  pear_admin > /root/backups/backup_$(date +%Y%m%d).sql
```

è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š
```bash
crontab -e
# æ·»åŠ ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /root/backup.sh
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†éƒ¨ç½²æ–‡æ¡£ï¼š[DEPLOY.md](./DEPLOY.md)
- Git æ“ä½œæŒ‡å—ï¼š[GIT_GUIDE.md](./GIT_GUIDE.md)
- æ—¥å¸¸æ›´æ–°æŒ‡å—ï¼š[æ›´æ–°æ¨é€æŒ‡å—.md](./æ›´æ–°æ¨é€æŒ‡å—.md)
- é¡¹ç›®è¯´æ˜ï¼š[README.md](./README.md)

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs -f`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`docker-compose ps`
3. å‚è€ƒ DEPLOY.md æ•…éšœæ’æŸ¥ç« èŠ‚

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
